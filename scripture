#!/bin/sh

# Usage sanitization
[ -z "$1" ] && echo "usage: scripture <deck file>" && exit 1

# TSV by default, otherwise use user's preference
DELIMITER=${SCRIPTURE_DELIMITER:-"	"}

# Determine which cards need to be reviewed
rm /tmp/scripture 2>/dev/null
while read line
do
	# Get epoch time of last review
	output="$(echo "$line" | cut -d"$DELIMITER" -f 6)"
	output="$(date +%s -d"$output")"

	# See if time since last review outlasts inter_repetition_interval (I)
	# 86400 --> num of seconds in 24 hours
	I="$(echo "$line" | cut -d"$DELIMITER" -f 5)"
	time_since="$(echo "$(date +%s) - $output" | bc -l)"

	# Does time since last review fulfills I's requirement
	[ "$time_since" -gt "$(echo "$I * 86400" | bc -l)" ] && echo "$line" >> /tmp/scripture
done <"$1"
echo "To review:"
cat /tmp/scripture 2>/dev/null || echo "None"